package com.niraven.app;

import android.content.SharedPreferences;
import android.graphics.Color;
import android.os.Bundle;
import android.widget.TextView;
import androidx.appcompat.app.AppCompatActivity;

public class BluetoothChatActivity extends AppCompatActivity {
    
    private TextView tvWelcome, tvMoodIndicator, tvStatus;
    private NiravenApp app;
    
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_bluetooth_chat);
        
        app = NiravenApp.getInstance();
        initializeViews();
        displayUserInfo();
        initializeBluetoothSystem();
    }
    
    private void initializeViews() {
        tvWelcome = findViewById(R.id.tvWelcome);
        tvMoodIndicator = findViewById(R.id.tvMoodIndicator);
        tvStatus = findViewById(R.id.tvStatus);
    }
    
    private void displayUserInfo() {
        String username = app.getSharedPreferences().getString("username", "User");
        String mood = app.getCurrentUserMood();
        int moodScore = app.getMoodScore();
        String moodColor = app.getMoodColor();
        
        tvWelcome.setText("Niraven Bluetooth - Welcome, " + username + "! üì°");
        tvMoodIndicator.setText("Your Mood: " + mood);
        tvMoodIndicator.setTextColor(Color.parseColor(moodColor));
        
        // Add mood-based status message
        String statusMessage = getMoodBasedStatus(mood, moodScore);
        tvStatus.setText(statusMessage);
    }
    
    private String getMoodBasedStatus(String mood, int score) {
        switch (mood) {
            case "EXCELLENT":
                return "üåü Great mood! Perfect for connecting with friends!";
            case "GOOD":
                return "üòä Feeling good! Ready to chat with nearby devices";
            case "NEUTRAL":
                return "üòê Neutral mood. Bluetooth connections available";
            case "SAD":
                return "üíô Feeling down? Maybe chatting will help cheer you up";
            default:
                return "üì° Bluetooth messenger ready for connections";
        }
    }
    
    private void initializeBluetoothSystem() {
        // INTEGRATION POINT: All our previous Bluetooth code goes here!
        // This is where you connect the multi-hop, encryption, file transfer system
        
        tvStatus.append("\n\nüöÄ Initializing Niraven Bluetooth System...");
        tvStatus.append("\n‚úÖ Multi-hop messaging ready");
        tvStatus.append("\n‚úÖ End-to-end encryption enabled");
        tvStatus.append("\n‚úÖ File transfer system active");
        tvStatus.append("\n‚úÖ Mood-aware routing optimized");
        
        // Mood-based connection optimization
        optimizeForMood();
    }
    
    private void optimizeForMood() {
        String mood = app.getCurrentUserMood();
        
        switch (mood) {
            case "EXCELLENT":
                tvStatus.append("\nüéØ Optimization: High-energy mode - Maximum device scanning");
                break;
            case "GOOD":
                tvStatus.append("\nüéØ Optimization: Balanced mode - Normal scanning intervals");
                break;
            case "NEUTRAL":
                tvStatus.append("\nüéØ Optimization: Power-saver mode - Reduced scanning");
                break;
            case "SAD":
                tvStatus.append("\nüéØ Optimization: Comfort mode - Priority on reliable connections");
                break;
        }
    }
    
    @Override
    protected void onResume() {
        super.onResume();
        // Refresh mood display when returning
        displayUserInfo();
    }
}
